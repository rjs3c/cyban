/* CyBan v1.1 | (c) 2022 by Ryan Instrell. */
const alert_banner=document.querySelector("#alert-banner"),mob_screen=window.matchMedia("(max-width: 800px)"),mob_screen_small=window.matchMedia("(max-width: 575px)"),entries_list_todo=document.querySelector("#todo.entries"),entries_list_pending=document.querySelector("#pending.entries"),entries_list_done=document.querySelector("#done.entries"),entries_actions_btns=document.querySelector(".entry-actions"),hide_sidebar_btn=document.querySelector("#btn-hide-sidebar"),add_form=document.querySelector("#add-entry-form"),login_form=document.querySelector("#login-form"),register_form=document.querySelector("#register-form"),show_login_password_btn=document.querySelector("#show-login-password"),show_register_password_btn=document.querySelector("#show-register-password"),show_change_password_btn=document.querySelector("#show-change-password"),filter_form=document.querySelector("#filter-menu"),sidebar=document.querySelector("#sidebar-row"),todo_count_text=document.querySelector("#todo-count"),pending_count_text=document.querySelector("#pending-count"),done_count_text=document.querySelector("#done-count"),todo_column=document.querySelector("#todo-column"),pending_column=document.querySelector("#pending-column"),done_column=document.querySelector("#done-column"),columns_row=document.querySelector(".row"),category_checkall_check=document.querySelector("#entry_category_select_all"),priority_checkall_check=document.querySelector("#entry_priority_select_all"),priority_checkboxes=document.querySelectorAll(".filter-priority-check"),category_checkboxes=document.querySelectorAll(".filter-category-check"),login_option=document.querySelector("#login-option"),logout_option=document.querySelector("#logout-option"),register_option=document.querySelector("#register-option"),account_option=document.querySelector("#account-option"),account_submenu=document.querySelector("#accountPageSubmenu"),account_form=document.querySelector("#account-form"),delete_account_btn=document.querySelector("#delete-account-btn"),executive_summary_option=document.querySelector("#exec-option"),recent_activity_option=document.querySelector("#activity-option"),append_epoch_check=document.querySelector("#append-epoch-option"),filename_field=document.querySelector("#filename-field"),mob_up_btn=document.querySelector("#mob-mov-up"),mob_down_btn=document.querySelector("#mob-mov-down"),logs_list=document.querySelector("#logs-list"),logs_prev_btn=document.querySelector("#prev-page"),logs_next_btn=document.querySelector("#next-page"),logs_page_num=document.querySelector("#page-number"),view_more_less=document.querySelector("#view-more-less"),entry_categories_more=document.querySelector("#entry-categories-more"),filter_entries_link=document.querySelector("#filter-entries-link"),columns=["#todo-column","#pending-column","#done-column"];let idle_interval,todo_delete_buttons=[],pending_delete_buttons=[],done_delete_buttons=[],edit_forms=[],col_3_prev_state=!1,params={},mouse_mov_counter=0,mob_scroll_pos=0,page_num=1,logs_length=0;const escapeOutput=e=>new Option(e).innerHTML,getAllEntries=async e=>{const{data:t}=await axios.get("/api/entries",{params:e});let o=[],s=[],a=[];t.map((e=>{const{_id:t,entry_title:l,entry_category:i,entry_status:n,entry_priority:r,entry_depends_on:c,createdAt:d}=e;let u=new Date,p=new Date(d),m=`${Math.trunc((u.getTime()-p.getTime())/864e5)}d`,_="";switch(r){case"low":_=`<div class="entry-priority low text-center text-uppercase bg-secondary"><p class="entry-priority-text fw-bold text-white">${escapeOutput(r)}</p></div>`;break;case"medium":_=`<div class="entry-priority medium text-center text-uppercase bg-secondary"><p class="entry-priority-text fw-bold text-white">${escapeOutput(r)}</p></div>`;break;case"high":_=`<div class="entry-priority high text-center text-uppercase bg-secondary"><p class="entry-priority-text fw-bold text-white">${escapeOutput(r)}</p></div>`}let y="",h="";switch(c&&(h="hide",y='<i class="child-icon fw-bold text-white-50 fas fa-child"></i>'),n){case"todo":o.push(`<div class="col todo entry" translate="off"><div class="row"><div class="col-6"><div class="entry-category text-center text-uppercase bg-secondary"><p class="entry-category-text fw-bold text-white">${escapeOutput(i)}</p></div></div><div class="col-6">${_}</div></div><div class="entry-header text-sm-start text-wrap"><p class="entry-header-text fs-5 text-black">${escapeOutput(l)}</p></div><div class="entry-actions text-end"><div class="row"><div class="col-4 created-at text-start"><p class="date-created-text text-sm-start fw-bold text-white-50">&nbsp;&nbsp;${m}</p>${y}</div><div class="col-8"><button type="button" class="btn btn-todo-create-child btn-sm refresh ${h}" data-id="${t}" data-entry-category="${escapeOutput(i)}" data-entry-status="${escapeOutput(n)}" data-entry-priority="${escapeOutput(r)}" title="Create Child Entry"><i class="btn-create-child-text fas fa-level-down-alt"></i></button><button type="button" class="btn btn-edit btn-sm refresh" data-bs-toggle="modal" data-bs-target="#modal-todo-${t}" title="Edit Entry"><i class="btn-edit-text fas fa-edit"></i></button><button type="button" class="btn btn-todo-delete btn-sm refresh" data-id="${t}" title="Delete Entry"><i class="btn-delete-text fas fa-trash-alt"></i></button></div></div></div></div><div class="modal fade modal-edit" id="modal-todo-${t}" tabindex="-1" aria-labelled-by="modal-todo-${t}-label" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" translate="yes"><div class="modal-content fw-bold"><div class="modal-header"><h5 class="modal-title" id="modal-todo-${t}-label">Edit Entry</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form class="edit-form" data-id="${t}"><div class="mb-3 text-start"><label for="entry_title" class="form-label">Entry Title</label><input type="text" class="form-control" id="entry_title" value="${escapeOutput(l)}" required tabindex="0" maxlength="60" placeholder="e.g. Entry Title"></div><div class="mb-3 text-start"><label for="entry_category" class="form-label">Entry Category</label><select class="form-select" id="entry_category" required><option value="control">control</option><option value="dp">data protection</option><option value="dr">disaster recovery</option><option value="event">event</option><option value="grc">governance/risk/compliance</option><option value="ir">incident response</option><option value="patch">patch</option><option value="privacy">privacy</option><option value="risk">risk</option><option value="test">test</option><option value="ta">training/awareness</option><option value="vulnerability">vulnerability</option></select></div><div class="mb-3 text-start"><label for="entry_priority" class="form-label">Entry Priority</label><select class="form-select" id="entry_priority" required><option value="low">low</option><option value="medium">medium</option><option value="high">high</option></select></div><div class="mb-3 text-start"><div class="form-check form-check-inline"><input type="radio" class="form-check-input" name="entry_status" value="todo" tabindex="3" checked><label class="form-check-label" for="todo-radio">Todo</label></div><div class="form-check form-check-inline"><input type="radio" class="form-check-input" name="entry_status" value="pending" tabindex="4"><label class="form-check-label" for="pending-radio">Pending</label></div><div class="form-check form-check-inline"><input type="radio" class="form-check-input" name="entry_status" value="done" tabindex="5"><label class="form-check-label" for="done-radio">Done</label></div></div><div class="modal-footer"><button type="submit" class="btn btn-dark" data-bs-dismiss="modal" tabindex="6">Submit</button></div></form></div></div></div></div>`.replace(/\\"/g,'"'));break;case"pending":s.push(`<div class="col pending entry" translate="off"><div class="row"><div class="col-6"><div class="entry-category text-center text-uppercase bg-secondary"><p class="entry-category-text fw-bold text-white">${escapeOutput(i)}</p></div></div><div class="col-6">${_}</div></div><div class="entry-header text-sm-start text-wrap"><p class="entry-header-text fs-5 text-black">${escapeOutput(l)}</p></div><div class="entry-actions text-end"><div class="row"><div class="col-4 created-at text-start"><p class="date-created-text text-sm-start fw-bold text-white-50">&nbsp;&nbsp;${m}</p>${y}</div><div class="col-8"><button type="button" class="btn btn-pending-create-child btn-sm refresh ${h}" data-id="${t}" data-entry-category="${escapeOutput(i)}" data-entry-status="${escapeOutput(n)}" data-entry-priority="${escapeOutput(r)}" title="Create Child Entry"><i class="btn-create-child-text fas fa-level-down-alt"></i></button><button type="button" class="btn btn-edit btn-sm refresh" data-bs-toggle="modal" data-bs-target="#modal-pending-${t}" title="Edit Entry"><i class="btn-edit-text fas fa-edit"></i></button><button type="button" class="btn btn-pending-delete btn-sm refresh" data-id="${t}" title="Delete Entry"><i class="btn-delete-text fas fa-trash-alt"></i></button></div></div></div></div><div class="modal fade modal-edit" id="modal-pending-${t}" tabindex="-1" aria-labelled-by="modal-pending-${t}-label" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" translate="yes"><div class="modal-content fw-bold"><div class="modal-header"><h5 class="modal-title" id="modal-pending-${t}-label">Edit Entry</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form class="edit-form" data-id="${t}"><div class="mb-3 text-start"><label for="entry_title" class="form-label">Entry Title</label><input type="text" class="form-control" id="entry_title" value="${escapeOutput(l)}" required tabindex="0" maxlength="60" placeholder="e.g. Entry Title"></div><div class="mb-3 text-start"><label for="entry_category" class="form-label">Entry Category</label><select class="form-select" id="entry_category" required><option value="control">control</option><option value="dp">data protection</option><option value="dr">disaster recovery</option><option value="event">event</option><option value="grc">governance/risk/compliance</option><option value="ir">incident response</option><option value="patch">patch</option><option value="privacy">privacy</option><option value="risk">risk</option><option value="test">test</option><option value="ta">training/awareness</option><option value="vulnerability">vulnerability</option></select></div><div class="mb-3 text-start"><label for="entry_priority" class="form-label">Entry Priority</label><select class="form-select" id="entry_priority" required><option value="low">low</option><option value="medium">medium</option><option value="high">high</option></select></div><div class="mb-3 text-start"><div class="form-check form-check-inline"><input type="radio" class="form-check-input" name="entry_status" value="todo" tabindex="3" checked><label class="form-check-label" for="todo-radio">Todo</label></div><div class="form-check form-check-inline"><input type="radio" class="form-check-input" name="entry_status" value="pending" tabindex="4"><label class="form-check-label" for="pending-radio">Pending</label></div><div class="form-check form-check-inline"><input type="radio" class="form-check-input" name="entry_status" value="done" tabindex="5"><label class="form-check-label" for="done-radio">Done</label></div></div><div class="modal-footer"><button type="submit" class="btn btn-dark" data-bs-dismiss="modal" tabindex="6">Submit</button></div></form></div></div></div></div>`.replace(/\\"/g,'"'));break;case"done":a.push(`<div class="col done entry" translate="off"><div class="row"><div class="col-6"><div class="entry-category text-center text-uppercase bg-secondary"><p class="entry-category-text fw-bold text-white">${escapeOutput(i)}</p></div></div><div class="col-6">${_}</div></div><div class="entry-header text-sm-start text-wrap"><p class="entry-header-text fs-5 text-black">${escapeOutput(l)}</p></div><div class="entry-actions text-end"><div class="row"><div class="col-4 created-at text-start"><p class="date-created-text text-sm-start fw-bold text-white-50">&nbsp;&nbsp;${m}</p>${y}</div><div class="col-8"><button type="button" class="btn btn-done-create-child btn-sm refresh ${h}" data-id="${t}" data-entry-category="${escapeOutput(i)}" data-entry-status="${escapeOutput(n)}" data-entry-priority="${escapeOutput(r)}" title="Create Child Entry"><i class="btn-create-child-text fas fa-level-down-alt"></i></button><button type="button" class="btn btn-edit btn-sm refresh" data-bs-toggle="modal" data-bs-target="#modal-done-${t}" title="Edit Entry"><i class="btn-edit-text fas fa-edit"></i></button><button type="button" class="btn btn-done-delete btn-sm refresh" data-id="${t}" title="Delete Entry"><i class="btn-delete-text fas fa-trash-alt"></i></button></div></div></div></div><div class="modal fade modal-edit" id="modal-done-${t}" tabindex="-1" aria-labelled-by="modal-done-${t}-label" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" translate="yes""><div class="modal-content fw-bold"><div class="modal-header"><h5 class="modal-title" id="modal-done-${t}-label">Edit Entry</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form class="edit-form" data-id="${t}"><div class="mb-3 text-start"><label for="entry_title" class="form-label">Entry Title</label><input type="text" class="form-control" id="entry_title" value="${escapeOutput(l)}" required tabindex="0" maxlength="60" placeholder="e.g. Entry Title"></div><div class="mb-3 text-start"><label for="entry_category" class="form-label">Entry Category</label><select class="form-select" id="entry_category" required><option value="control">control</option><option value="dp">data protection</option><option value="dr">disaster recovery</option><option value="event">event</option><option value="grc">governance/risk/compliance</option><option value="ir">incident response</option><option value="patch">patch</option><option value="privacy">privacy</option><option value="risk">risk</option><option value="test">test</option><option value="ta">training/awareness</option><option value="vulnerability">vulnerability</option></select></div><div class="mb-3 text-start"><label for="entry_priority" class="form-label">Entry Priority</label><select class="form-select" id="entry_priority" required><option value="low">low</option><option value="medium">medium</option><option value="high">high</option></select></div><div class="mb-3 text-start"><div class="form-check form-check-inline"><input type="radio" class="form-check-input" name="entry_status" value="todo" tabindex="3" checked><label class="form-check-label" for="todo-radio">Todo</label></div><div class="form-check form-check-inline"><input type="radio" class="form-check-input" name="entry_status" value="pending" tabindex="4"><label class="form-check-label" for="pending-radio">Pending</label></div><div class="form-check form-check-inline"><input type="radio" class="form-check-input" name="entry_status" value="done" tabindex="5"><label class="form-check-label" for="done-radio">Done</label></div></div><div class="modal-footer"><button type="submit" class="btn btn-dark" data-bs-dismiss="modal" tabindex="6">Submit</button></div></form></div></div></div></div>`.replace(/\\"/g,'"'))}})),total_count=o.length+s.length+a.length,todo_count_text.textContent=`(${o.length}/${total_count})`,pending_count_text.textContent=`(${s.length}/${total_count})`,done_count_text.textContent=`(${a.length}/${total_count})`,0===o.length&&o.push('<div class="alert alert-danger fade show" role="alert"><strong>List is empty.</strong></div>'.replace(/\\"/g,'"')),0===s.length&&s.push('<div class="alert alert-danger fade show" role="alert"><strong>List is empty.</strong></div>'.replace(/\\"/g,'"')),0===a.length&&a.push('<div class="alert alert-danger fade show" role="alert"><strong>List is empty.</strong></div>'.replace(/\\"/g,'"')),entries_list_todo.innerHTML=o.join(" "),entries_list_pending.innerHTML=s.join(" "),entries_list_done.innerHTML=a.join(" "),todo_delete_buttons=Array.prototype.slice.call(document.querySelectorAll(".btn-todo-delete")),pending_delete_buttons=Array.prototype.slice.call(document.querySelectorAll(".btn-pending-delete")),done_delete_buttons=Array.prototype.slice.call(document.querySelectorAll(".btn-done-delete")),todo_create_child_buttons=Array.prototype.slice.call(document.querySelectorAll(".btn-todo-create-child")),pending_create_child_buttons=Array.prototype.slice.call(document.querySelectorAll(".btn-pending-create-child")),done_create_child_buttons=Array.prototype.slice.call(document.querySelectorAll(".btn-done-create-child")),edit_forms=document.querySelectorAll(".edit-form"),Array.prototype.slice.call(edit_forms).forEach((e=>{e.addEventListener("submit",(t=>{t.preventDefault();let o={};Array.prototype.slice.call(e.elements).forEach((e=>{switch(e.id){case"entry_title":o.entry_title=e.value;break;case"entry_category":o.entry_category=e.value;break;case"entry_priority":o.entry_priority=e.value}if("entry_status"===e.name)e.checked&&(o.entry_status=e.value)})),editEntry(e.dataset.id,o)}))})),todo_create_child_buttons.forEach((e=>{e.addEventListener("click",(()=>{createChild(e.dataset.id,e.dataset.entryCategory,e.dataset.entryStatus,e.dataset.entryPriority)}))})),pending_create_child_buttons.forEach((e=>{e.addEventListener("click",(()=>{createChild(e.dataset.id,e.dataset.entryCategory,e.dataset.entryStatus,e.dataset.entryPriority)}))})),done_create_child_buttons.forEach((e=>{e.addEventListener("click",(()=>{createChild(e.dataset.id,e.dataset.entryCategory,e.dataset.entryStatus,e.dataset.entryPriority)}))})),todo_delete_buttons.forEach((e=>{e.addEventListener("click",(()=>deleteEntry(e.dataset.id)))})),pending_delete_buttons.forEach((e=>{e.addEventListener("click",(()=>deleteEntry(e.dataset.id)))})),done_delete_buttons.forEach((e=>{e.addEventListener("click",(()=>deleteEntry(e.dataset.id)))}))},editEntry=async(e,t)=>{await axios.patch(`/api/entries/${e}`,t).then((e=>{showAlertSuccess(e.data.msg),getAllEntries()})).catch((e=>showAlertFailure(e.response.data.msg)))},deleteEntry=async e=>{await axios.delete(`/api/entries/${e}`).then((e=>{showAlertSuccess(e.data.msg),getAllEntries()})).catch((e=>showAlertFailure(e.response.data.msg)))},createChild=async(e,t,o,s)=>{let a={entry_title:"Child",entry_category:t,entry_status:o,entry_priority:s,entry_depends_on:e};await axios.post("/api/entries",a).then((e=>{showAlertSuccess(e.data.msg),getAllEntries()})).catch((e=>showAlertFailure(e.response.data.msg)))},checkAuthenticated=async()=>{await axios.get("/api/auth/").then().catch((e=>{403!==e.response.status?(register_option.classList.remove("show"),register_option.classList.add("hide"),login_option.classList.remove("show"),login_option.classList.add("hide"),logout_option.classList.remove("hide"),logout_option.classList.add("show"),account_option.classList.remove("hide"),account_option.classList.add("show"),executive_summary_option.classList.remove("hide"),executive_summary_option.classList.add("show"),recent_activity_option.classList.remove("hide"),recent_activity_option.classList.add("show"),idleTimer(),window.addEventListener("mousemove",(()=>mouse_mov_counter=0))):(register_option.classList.remove("hide"),register_option.classList.add("show"),login_option.classList.remove("hide"),login_option.classList.add("show"),logout_option.classList.remove("show"),logout_option.classList.add("hide"),account_option.classList.remove("show"),account_option.classList.add("hide"),executive_summary_option.classList.remove("show"),executive_summary_option.classList.add("hide"),recent_activity_option.classList.remove("show"),recent_activity_option.classList.add("hide"),void 0!==idleTimer&&clearInterval(idle_interval))}))},idleTimer=()=>{idle_interval=setInterval((()=>{mouse_mov_counter++,10===mouse_mov_counter?showAlertFailure("Warning: Because you are idle, you will be deauthenticated in 5 minutes. Please move your mouse to stay logged in."):mouse_mov_counter>15&&(clearInterval(idle_interval),logout_option.click())}),6e4)};window.addEventListener("mousemove",(()=>mouse_mov_counter=0)),add_form.addEventListener("submit",(async e=>{e.preventDefault();let t={};Array.prototype.slice.call(add_form.elements).forEach((e=>{switch(e.id){case"entry_title":t.entry_title=e.value;break;case"entry_category":t.entry_category=e.value;break;case"entry_priority":t.entry_priority=e.value}if("entry_status"===e.name)e.checked&&(t.entry_status=e.value)})),add_form.reset(),await axios.post("/api/entries",t).then((e=>{showAlertSuccess(e.data.msg),getAllEntries()})).catch((e=>showAlertFailure(e.response.data.msg)))})),filter_form.addEventListener("submit",(async e=>{e.preventDefault(),params.entry_category=[],params.entry_priority=[],Array.prototype.slice.call(filter_form.elements).forEach((e=>{switch(e.name){case"entry_category_filter":if(e.checked)switch(e.value){case"control":case"dp":case"dr":case"event":case"grc":case"ir":case"patch":case"privacy":case"risk":case"test":case"ta":case"vulnerability":params.entry_category.push(e.value)}break;case"entry_priority_filter":if(e.checked)switch(e.value){case"low":case"medium":case"high":params.entry_priority.push(e.value)}break;case"entry_search_expr":params.entry_search=e.value}})),0===params.entry_category.length&&params.entry_category.push("notapplicable"),0===params.entry_priority.length&&params.entry_priority.push("notapplicable"),getAllEntries(params)})),login_form.addEventListener("submit",(async e=>{e.preventDefault();let t={};Array.prototype.slice.call(login_form.elements).forEach((e=>{switch(e.id){case"login-username":t.username=e.value;break;case"login-password":t.password=e.value}})),login_form.reset(),await axios.post("/api/auth/login",t).then((e=>{showAlertSuccess(e.data.msg),checkAuthenticated()})).catch((e=>showAlertFailure(e.response.data.msg)))})),register_form.addEventListener("submit",(async e=>{e.preventDefault();let t={};Array.prototype.slice.call(register_form.elements).forEach((e=>{switch(e.id){case"register-username":t.username=e.value;break;case"register-password":t.password=e.value}})),register_form.reset(),await axios.post("/api/auth/register",t).then((e=>showAlertSuccess(e.data.msg))).catch((e=>showAlertFailure(e.response.data.msg)))})),account_form.addEventListener("submit",(async e=>{e.preventDefault();let t={};Array.prototype.slice.call(account_form.elements).forEach((e=>{if("change-password"===e.id)t.password=e.value})),account_form.reset(),await axios.patch("/api/users/changepassword",t).then((e=>showAlertSuccess(e.data.msg))).catch((e=>showAlertFailure(e.response.data.msg)))})),logout_option.addEventListener("click",(async()=>{await axios.get("/api/auth/logout").then((e=>{showAlertSuccess(e.data.msg),account_submenu.classList.remove("show"),checkAuthenticated()})).catch((e=>showAlertFailure(e.response.data.msg)))})),delete_account_btn.addEventListener("click",(async()=>{await axios.delete("/api/users/delete").then((e=>{showAlertSuccess(e.data.msg),logout_option.click()})).catch((e=>showAlertFailure(e.response.data.msg)))}));const showAlertSuccess=e=>{let t=`<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>${escapeOutput(e)}</strong></div>`;alert_banner.innerHTML=t,setTimeout((()=>alert_banner.innerHTML=""),4e3)},showAlertFailure=e=>{let t=`<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>${escapeOutput(e)}</strong></div>`;alert_banner.innerHTML=t,setTimeout((()=>alert_banner.innerHTML=""),4e3)};show_login_password_btn.addEventListener("click",(()=>{let e=document.querySelector("#login-password");"password"===e.type?(show_login_password_btn.innerHTML='<i class="fas fa-eye"></i>',e.type="text"):(show_login_password_btn.innerHTML='<i class="fas fa-eye-slash"></i>',e.type="password")})),show_register_password_btn.addEventListener("click",(()=>{let e=document.querySelector("#register-password");"password"===e.type?(show_register_password_btn.innerHTML='<i class="fas fa-eye"></i>',e.type="text"):(show_register_password_btn.innerHTML='<i class="fas fa-eye-slash"></i>',e.type="password")})),show_change_password_btn.addEventListener("click",(()=>{let e=document.querySelector("#change-password");"password"===e.type?(show_change_password_btn.innerHTML='<i class="fas fa-eye"></i>',e.type="text"):(show_change_password_btn.innerHTML='<i class="fas fa-eye-slash"></i>',e.type="password")}));const getRecentActivity=async()=>{let e={page_num:page_num??1},t=[];const{data:o}=await axios.get("/api/logs",{params:e});logs_length=o.logs_count,o.logs_list.map((e=>{const{user:o,action:s,createdAt:a}=e;let l=new Date,i=new Date(a),n=`${Math.trunc((l.getTime()-i.getTime())/864e5)}d`;switch(s){case"created":t.push(`<tr class="align-middle"><td class="table-success"><i class="icon-text text-black fw-bold fas fa-plus"></i></td><td><p class="text-black fw-bold">${escapeOutput(o)} ${escapeOutput(s)} an entry</p></td></td><td><p class="log-date-text fw-bold text-secondary">${n}</p></td></tr>`.replace(/\\"/g,'"'));break;case"modified":t.push(`<tr class="align-middle"><td class="table-warning"><i class="icon-text align-middle text-black fw-bold fas fa-tools"></i></td><td><p class="text-black fw-bold">${escapeOutput(o)} ${escapeOutput(s)} an entry</p></td><td><p class="log-date-text fw-bold text-secondary">${n}</p></td></tr>`.replace(/\\"/g,'"'));break;case"deleted":t.push(`<tr class="align-middle"><td class="table-danger"><i class="icon-text align-middle text-black fw-bold fas fa-times"></i></td><td><p class="text-black fw-bold">${escapeOutput(o)} ${escapeOutput(s)} an entry</p></td><td><p class="log-date-text fw-bold text-secondary">${n}</p></td></tr>`.replace(/\\"/g,'"'))}})),0===t.length&&t.push('<tr class="align-middle"><td><div class="alert alert-danger fade show" role="alert"><strong>No recent activity.</strong></div></td></tr>'.replace(/\\"/g,'"')),logs_list.innerHTML=t.join(" ")};recent_activity_option.addEventListener("click",(()=>{page_num=1,logs_page_num.textContent=`Page ${escapeOutput(page_num)}`,getRecentActivity()})),logs_prev_btn.addEventListener("click",(()=>{page_num<=Math.ceil(logs_length/5)+1&&page_num>1&&page_num--,logs_page_num.textContent=`Page ${escapeOutput(page_num)}`,getRecentActivity()})),logs_next_btn.addEventListener("click",(()=>{page_num<=Math.floor(logs_length/5)&&page_num++,logs_page_num.textContent=`Page ${escapeOutput(page_num)}`,getRecentActivity()})),hide_sidebar_btn.addEventListener("click",(()=>{sidebar.classList.contains("hide")?(sidebar.classList.remove("hide"),sidebar.classList.add("show"),columns_row.classList.remove("justify-content-center"),columns_row.classList.add("justify-content-start"),mob_screen.matches||(todo_column.classList.remove("col-sm-4"),pending_column.classList.remove("col-sm-4"),done_column.classList.remove("col-sm-4"),todo_column.classList.add("col-sm-3"),pending_column.classList.add("col-sm-3"),done_column.classList.add("col-sm-3")),hide_sidebar_btn.innerHTML='<i class="fas fa-chevron-left">'):(sidebar.classList.remove("show"),sidebar.classList.add("hide"),columns_row.classList.remove("justify-content-start"),columns_row.classList.add("justify-content-center"),todo_column.classList.remove("col-sm-3"),pending_column.classList.remove("col-sm-3"),done_column.classList.remove("col-sm-3"),todo_column.classList.add("col-sm-4"),pending_column.classList.add("col-sm-4"),done_column.classList.add("col-sm-4"),hide_sidebar_btn.innerHTML='<i class="fas fa-chevron-right">')})),category_checkall_check.addEventListener("change",(()=>{category_checkall_check.checked?category_checkboxes.forEach((e=>e.checked=!0)):category_checkboxes.forEach((e=>e.checked=!1))})),priority_checkall_check.addEventListener("change",(()=>{priority_checkall_check.checked?priority_checkboxes.forEach((e=>e.checked=!0)):priority_checkboxes.forEach((e=>e.checked=!1))})),category_checkboxes.forEach((e=>e.addEventListener("change",(()=>e.checked?null:category_checkall_check.checked=!1)))),priority_checkboxes.forEach((e=>e.addEventListener("change",(()=>e.checked?null:priority_checkall_check.checked=!1)))),append_epoch_check.addEventListener("change",(()=>{!0===append_epoch_check.checked&&(filename_field.value+=`-${parseInt((new Date).getTime()/1e3)}`,append_epoch_check.disabled=!0)})),filter_entries_link.addEventListener("click",(()=>{view_more_less.classList.remove("hide"),view_more_less.classList.add("add"),entry_categories_more.classList.remove("show"),entry_categories_more.classList.add("hide")})),view_more_less.addEventListener("click",(()=>{view_more_less.classList.remove("add"),view_more_less.classList.add("hide"),entry_categories_more.classList.remove("hide"),entry_categories_more.classList.add("show")})),mob_screen_small.addEventListener("change",(()=>{mob_screen_small.matches||window.scrollTo({top:0,behavior:"smooth"})})),mob_screen.addEventListener("change",(()=>{mob_screen.matches?(document.querySelectorAll(".btn-close").forEach((e=>e.click())),"col-sm-3"===todo_column.classList[0]&&"col-sm-3"===pending_column.classList[0]&&"col-sm-3"===done_column.classList[0]?(col_3_prev_state=!0,sidebar.classList.contains("show")&&(sidebar.classList.remove("show"),sidebar.classList.add("hide")),todo_column.classList.remove("col-sm-3"),pending_column.classList.remove("col-sm-3"),done_column.classList.remove("col-sm-3"),todo_column.classList.add("col-sm-4"),pending_column.classList.add("col-sm-4"),done_column.classList.add("col-sm-4")):(col_3_prev_state=!1,sidebar.classList.contains("show")&&(sidebar.classList.remove("show"),sidebar.classList.add("hide")),todo_column.classList.remove("col-sm-4"),pending_column.classList.remove("col-sm-4"),done_column.classList.remove("col-sm-4"),todo_column.classList.add("col-sm-4"),pending_column.classList.add("col-sm-4"),done_column.classList.add("col-sm-4"))):!0===col_3_prev_state?(sidebar.classList.contains("show")?(sidebar.classList.remove("show"),sidebar.classList.add("hide")):(sidebar.classList.remove("hide"),sidebar.classList.add("show")),todo_column.classList.remove("col-sm-4"),pending_column.classList.remove("col-sm-4"),done_column.classList.remove("col-sm-4"),todo_column.classList.add("col-sm-3"),pending_column.classList.add("col-sm-3"),done_column.classList.add("col-sm-3")):(sidebar.classList.remove("show"),sidebar.classList.add("hide"))})),window.innerWidth<=800&&(col_3_prev_state=!1,todo_column.classList.remove("col-sm-3"),pending_column.classList.remove("col-sm-3"),done_column.classList.remove("col-sm-3"),todo_column.classList.add("col-sm-4"),pending_column.classList.add("col-sm-4"),done_column.classList.add("col-sm-4")),mob_up_btn.addEventListener("click",(()=>{switch(mob_scroll_pos){case 0:var e=200,t=document.querySelector(columns[mob_scroll_pos]).getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:t,behavior:"smooth"});break;case 1:mob_scroll_pos--;e=200,t=document.querySelector(columns[mob_scroll_pos]).getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:t,behavior:"smooth"});break;case 2:mob_scroll_pos--;e=200,t=document.querySelector(columns[mob_scroll_pos]).getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:t,behavior:"smooth"})}})),mob_down_btn.addEventListener("click",(()=>{switch(mob_scroll_pos){case 0:mob_scroll_pos++;var e=200,t=document.querySelector(columns[mob_scroll_pos]).getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:t,behavior:"smooth"});break;case 1:mob_scroll_pos++;e=200,t=document.querySelector(columns[mob_scroll_pos]).getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:t,behavior:"smooth"});break;case 2:e=200,t=document.querySelector(columns[mob_scroll_pos]).getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:t,behavior:"smooth"})}})),setInterval((()=>{let e=document.querySelectorAll(".modal-edit"),t=!0;e.forEach((e=>e.classList.contains("show")?t=!1:null)),!0===t&&getAllEntries(params)}),1e3),window.onload=()=>{getAllEntries(params),checkAuthenticated(),window.scrollTo({top:0,behavior:"smooth"}),window.focus(),append_epoch_check.checked=!1},window.onunload=async()=>await axios.get("/api/auth/logout");